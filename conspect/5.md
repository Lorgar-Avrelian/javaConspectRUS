# 5 Тестирование

> [[_оглавление_]](../README.md/#5-тестирование)

Тесты нужны для проверки качества и корректности кода на самом раннем этапе, когда код еще не вышел из рук разработчика.

## 5.1 JUnit

> [[_оглавление_]](../README.md/#51-junit-)

[**JUnit**](/conspect/definitions.md/#j) - это основной фреймворк для модульных тестов на Java.

Тесты выглядят так же, как обычные методы с дополнительными аннотациями.

Работа с _JUnit5_ (актуальная версия _JUnit_) строится следующим образом:

- создаётся класс в разделе _test_ (вместо _main_), имя которого соответствует тестируемому + приписка `Test` в конце;
  пакет должен соответствовать пакету тестируемого файла, что помогает избежать проблем с доступом к
  методам `package-private`;
- в тестовом классе создается объект тестируемого класса и тестовые данные;
- пишутся методы, каждый из которых покрывает отдельный вариант развития событий: имена даются соответствующие (
  например, `shouldReturnHelloIvanWhenNameIvanReceived()`);
- методы помечаются необходимыми аннотациями;
- при необходимости пишутся методы, которые подготавливают тестовые данные;
- _JUnit_ запускает каждый из методов отдельно друг от друга.

Основные аннотации, используемые фреймворком _JUnit_ указаны в
разделе [3.4 Аннотации Spring](/conspect/3.md/#34-аннотации-spring).

Пример:

```java

@DisplayName(value = "Test of CounterServiceImpl")
@ExtendWith(MockitoExtension.class)
@TestMethodOrder(MethodOrderer.OrderAnnotation.class)
class CounterServiceImplTest {
    private final CounterService counterService = new CounterServiceImpl();

    @Test
    @DisplayName(value = "Get counter test")
    @Order(1)
    @Timeout(value = 100, unit = TimeUnit.MILLISECONDS)
    void getCounter() {
        counterService.setCounter(0);
        int counterValue = counterService.getCounter();
        int expectedValue = 1;
        Assertions.assertEquals(expectedValue, counterValue);
        counterValue = counterService.getCounter();
        expectedValue = 2;
        Assertions.assertEquals(expectedValue, counterValue);
        counterValue = counterService.getCounter();
        expectedValue = 3;
        Assertions.assertEquals(expectedValue, counterValue);
    }

    @Test
    @DisplayName(value = "Set counter test")
    @Order(2)
    @Timeout(value = 100, unit = TimeUnit.MILLISECONDS)
    void setCounter() {
        counterService.setCounter(0);
        int counterValue = counterService.getCounter();
        int expectedValue = 1;
        Assertions.assertEquals(expectedValue, counterValue);
        counterService.getCounter();
        counterService.getCounter();
        counterService.getCounter();
        counterService.getCounter();
        counterService.setCounter(0);
        counterValue = counterService.getCounter();
        expectedValue = 1;
        Assertions.assertEquals(expectedValue, counterValue);
    }

    @Test
    @DisplayName(value = "Set counter test 2")
    @Disabled("Test off")
    @Order(3)
    @Timeout(value = 100, unit = TimeUnit.MILLISECONDS)
    void setCounter2() {
        counterService.setCounter(0);
        int counterValue = counterService.getCounter();
        int expectedValue = 1;
        Assertions.assertEquals(expectedValue, counterValue);
        counterService.getCounter();
        counterService.getCounter();
        counterService.getCounter();
        counterService.getCounter();
        counterService.setCounter(0);
        counterValue = counterService.getCounter();
        expectedValue = 1;
        Assertions.assertEquals(expectedValue, counterValue);
    }
}
```

### 5.1.1 Подключение JUnit

> [[_оглавление_]](../README.md/#51-junit-)

Подключение фреймворка _JUnit_ производится путём добавления зависимости в файл:

- _pom.xml_:

```xml

<dependency>
    <groupId>org.junit.jupiter</groupId>
    <artifactId>junit-jupiter-engine</artifactId>
    <version>5.11.0</version>
    <scope>test</scope>
</dependency>
```

- _build.gradle_:

```groovy
// https://mvnrepository.com/artifact/org.junit.jupiter/junit-jupiter-engine
testImplementation 'org.junit.jupiter:junit-jupiter-engine:5.11.0'
```

### 5.1.2 Класс Assertions

> [[_оглавление_]](../README.md/#51-junit-)

Проверка данных в тестах производится с помощью методов специальных классов. Эти методы проверяют условие и, если
условие не выполняется, вызывают специальный метод, который сообщают фреймворку о непройденном условии, а уже фреймворк
роняет тест. В случае прохождения проверки методы не делают ничего и, соответственно, дают тесту выполниться, получив
отметку «успех».  
Библиотека _JUnit5_ хранит такие методы в классе _Assertions_.  
Все методы класса _Assertions_ статические и не требуют создания объектов для вызова.

#### 5.1.2.1 assertEquals()

> [[_оглавление_]](../README.md/#51-junit-)

Метод `assertEquals()` класса `Assertions` проверяет, что два объекта или примитива равны друг другу.  
Для проверки объектов на равенство у них должен быть реализован метод `equals()`.

Синтаксис метода выглядит следующим образом:

```java
Assertions.assertEquals([ожидаемое_значение], [полученное_значение]);
```

#### 5.1.2.2 assertNotEquals()

> [[_оглавление_]](../README.md/#51-junit-)

Метод `assertNotEquals()` класса `Assertions` проверяет, что два объекта или примитива не равны друг другу.  
Для проверки объектов на равенство у них должен быть реализован метод `equals()`.

Синтаксис метода выглядит следующим образом:

```java
Assertions.assertNotEquals([ожидаемое_значение], [полученное_значение]);
```

#### 5.1.2.3 assertArrayEquals()

> [[_оглавление_]](../README.md/#51-junit-)

Метод `assertArrayEquals()` класса `Assertions` проверяет, что два массива равны друг другу.  
Для проверки объектов на равенство у них должен быть реализован метод `equals()`.

Синтаксис метода выглядит следующим образом:

```java
Assertions.assertArrayEquals([ожидаемое_значение_массива], [полученное_значение_массива]);
```

#### 5.1.2.4 assertIterableEquals()

> [[_оглавление_]](../README.md/#51-junit-)

Метод `assertIterableEquals()` класса `Assertions` проверяет, что две коллекции равны друг другу.  
Для проверки объектов на равенство у них должен быть реализован метод `equals()`.

Синтаксис метода выглядит следующим образом:

```java
Assertions.assertIterableEquals([ожидаемое_значение_коллекции], [полученное_значение_коллекции]);
```

#### 5.1.2.5 assertTrue()

> [[_оглавление_]](../README.md/#51-junit-)

Метод `assertTrue()` класса `Assertions` проверяет, что переданный в него объект или результат выполнения метода
возвращает `true`.

Синтаксис метода выглядит следующим образом:

```java
Assertions.assertTrue([проверяемое_значение]);
```

#### 5.1.2.6 assertFalse()

> [[_оглавление_]](../README.md/#51-junit-)

Метод `assertFalse()` класса `Assertions` проверяет, что переданный в него объект или результат выполнения метода
возвращает `false`.

Синтаксис метода выглядит следующим образом:

```java
Assertions.assertFalse([проверяемое_значение]);
```

#### 5.1.2.7 assertNull()

> [[_оглавление_]](../README.md/#51-junit-)

Метод `assertNull()` класса `Assertions` проверяет, что переданный в него объект или результат выполнения метода
является `null`.

Синтаксис метода выглядит следующим образом:

```java
Assertions.assertNull([проверяемое_значение]);
```

#### 5.1.2.8 assertNotNull()

> [[_оглавление_]](../README.md/#51-junit-)

Метод `assertNotNull()` класса `Assertions` проверяет, что переданный в него объект или результат выполнения метода не
является `null`.

Синтаксис метода выглядит следующим образом:

```java
Assertions.assertNotNull([проверяемое_значение]);
```

#### 5.1.2.9 assertThrows()

> [[_оглавление_]](../README.md/#51-junit-)

Метод `assertThrows()` класса `Assertions` проверяет, что при выполнении операции выбрасывается исключение указанного
типа.

Синтаксис метода выглядит следующим образом:

```java
Assertions.assertThrows([класс_исключения], [лямбда_операции]);
```

Пример:

```text
Assertions.assertThrows(IllegalArgumentException.class, () -> out.generateGreetings(ILLEGAL_ARGUMENT_NAME));
```

Метод имеет два параметра. Первый параметр принимает класс ожидаемого исключения, второй параметр принимает лямбду,
которая не имеет параметров и должна вызывать тестируемый метод.

#### 5.1.2.10 assertDoesNotThrow()

> [[_оглавление_]](../README.md/#51-junit-)

Метод `assertDoesNotThrow()` класса `Assertions` проверяет, что при выполнении операции не выбрасывается исключений.

Синтаксис метода выглядит следующим образом:

```java
Assertions.assertDoesNotThrow([лямбда_операции]);
```

Пример:

```text
Assertions.assertThrows(() -> out.generateGreetings(NORMAL_ARGUMENT_NAME));
```

Метод имеет один параметр в виде лямбды без параметров, которая вызывает проверяемый код.

## 5.2 Параметризованные тесты

> [[_оглавление_]](../README.md/#52-параметризованные-тесты)

Параметризованные тесты позволяют вызвать тест несколько раз с различными параметрами: разные значения, разные входные
параметры, разные имена пользователей.

Для использования параметризованных тестов нужно добавить отдельную библиотеку в файл:

- _pom.xml_:

```xml
<!-- https://mvnrepository.com/artifact/org.junit.jupiter/junit-jupiter-params -->
<dependency>
    <groupId>org.junit.jupiter</groupId>
    <artifactId>junit-jupiter-params</artifactId>
    <version>5.11.0</version>
    <scope>test</scope>
</dependency>
```

- _build.gradle_:

```groovy
// https://mvnrepository.com/artifact/org.junit.jupiter/junit-jupiter-params
testImplementation 'org.junit.jupiter:junit-jupiter-params:5.11.0'
```

Параметризованные тесты создаются в следующем порядке:

- создаётся сам тестовый класс стандартным способом (<kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>T</kbd>);
- в тестовом классе создаётся статический метод, который возвращает `Stream<Arguments>` (объекты типа `Arguments`,
  которые затем фреймворк подставит в качестве параметра в тестирующий метод);
- отметить тестовый метод, который должен получать параметризованный поток, аннотациями `@ParameterizedTest` (вместо
  аннотации `@Test`) и аннотациями `@MethodSource`, `@EnumSource`, `@NullSource` или `@ValueSource`;
- запустить тест.

Пример:

```java
class GreetingsServiceParameterizedTest {

    private final GreetingsService out = new GreetingsService();

    @Test
    public void shouldReturnDefaultMessageWhenNameIsNotExists() {
        String result = out.generateGreetings();
        assertTrue(result.contains(DEFAULT_NAME));
        assertEquals(DEFAULT_MESSAGE, result);
    }

    @ParameterizedTest
    @MethodSource("provideParamsForTests")
    public void shouldGenerateCorrectMessages(String inputName, String messageName, String expectedMessage) {
        String result = out.generateGreetings(inputName);
        assertTrue(result.contains(messageName));
        assertEquals(expectedMessage, result);
    }

    @Test
    public void shouldThrowIllegalArgumentExceptionWhenNameContainsIllegalCharacters() {
        assertThrows(IllegalArgumentException.class,
                     () -> out.generateGreetings(ILLEGAL_CHARACTERS_NAME)
                    );
    }

    public static Stream<Arguments> provideParamsForTests() {
        return Stream.of(
                Arguments.of(null, DEFAULT_NAME, DEFAULT_MESSAGE),
                Arguments.of(EMPTY_NAME, DEFAULT_NAME, DEFAULT_MESSAGE),
                Arguments.of(ONLY_SPACES_NAME, DEFAULT_NAME, DEFAULT_MESSAGE),
                Arguments.of(CORRECT_NAME, CORRECT_NAME, CORRECT_MESSAGE),
                Arguments.of(UPPER_CASE_NAME, CORRECT_NAME, CORRECT_MESSAGE),
                Arguments.of(LOWER_CASE_NAME, CORRECT_NAME, CORRECT_MESSAGE)
                        );
    }
}
```